# V5 æŠ€æœ¯å¯è¡Œæ€§åˆ†æä¸è°ƒæ•´æ–¹æ¡ˆæŠ¥å‘Š

> ç”Ÿæˆæ—¥æœŸ: 2026-01-08
> å¯¹åº”æ–‡æ¡£: Leaflet_å¼€å‘æ‰§è¡Œæ–‡æ¡£_V5_å…¨é‡åˆå¹¶ç‰ˆ.md

---

## ä¸€ã€V5 æ–‡æ¡£æ ¸å¿ƒå˜æ›´å¯¹ç…§è¡¨

| å˜æ›´é¡¹ | å½“å‰å®ç° | V5 è¦æ±‚ | æ”¹åŠ¨å¹…åº¦ |
|--------|----------|---------|---------|
| **Preset æ•°é‡** | 4 ä¸ª (å« Newsprint) | 3 ä¸ª (ç§»é™¤ Newsprint) | ğŸŸ¢ å° |
| **æ»¤é•œå®ç°** | ç®—æ³•å‹ (saturate/contrast/brightness/warmth/grain) | å›¾ç‰‡å åŠ  Multiply | ğŸ”´ å¤§ |
| **ç”¨æˆ·å‚æ•°** | é£æ ¼å¼ºåº¦æ˜ å°„ 5 ä¸ªå‚æ•° | ä»…æ§åˆ¶ Filter Image opacity | ğŸŸ¡ ä¸­ |
| **ç§»é™¤åŠŸèƒ½** | è‰²æ¸©/é¥±å’Œåº¦/å¯¹æ¯”åº¦/é¢—ç²’/æš—è§’ | å®Œå…¨åˆ é™¤ | ğŸŸ¢ å° |
| **å­—ä½“** | Google Fonts (Libre Baskerville/Inter/Source Serif) | æœ¬åœ°é™æ€æ–‡ä»¶ (Crimson Text/Averia Serif/New Athena) | ğŸŸ¡ ä¸­ |
| **æ’ç‰ˆå‚æ•°** | å­—å· 42-58, è¡Œé«˜ 1.44-1.52, å®½åº¦ 68% | å­—å· 52-56, è¡Œé«˜ 160%-170%, å®½åº¦ 75% | ğŸŸ¢ å° |
| **é£æ ¼é€‰æ‹© UI** | æ–‡å­— Pills | ç¼©ç•¥å›¾ + åç§° | ğŸŸ¢ å° |
| **Author å¯¹é½** | è·Ÿéš Quote | ç‹¬ç«‹æ§åˆ¶ (Right/Center) | ğŸŸ¡ ä¸­ |
| **èƒŒæ™¯å›¾** | çº¯è‰² + å™ªå£°ç®—æ³• | é™æ€èƒŒæ™¯å›¾ cover å¡«å…… | ğŸ”´ å¤§ |

---

## äºŒã€æŠ€æœ¯å¯è¡Œæ€§è¯„ä¼°

### âœ… å®Œå…¨å¯è¡Œçš„æ”¹åŠ¨

| æ”¹åŠ¨ | è¯„ä¼° | å·¥ä½œé‡ |
|------|------|--------|
| ç§»é™¤ Newsprint Preset | åˆ é™¤ `presets.ts` ä¸­é…ç½® | 5 åˆ†é’Ÿ |
| ç”»å¸ƒæ¯”ä¾‹åªæ˜¾ç¤ºæ¯”ä¾‹ | ä¿®æ”¹ UI æ–‡æ¡ˆ `4:5` / `1:1` | 5 åˆ†é’Ÿ |
| æ§åˆ¶åŒºæœ€å¤§å®½åº¦ 360px | ä¿®æ”¹ CSS (å½“å‰ 420px) | 5 åˆ†é’Ÿ |
| ç”»å¸ƒé¢„è§ˆæœ€å¤§å®½åº¦ 800px | ä¿®æ”¹ CSS (å½“å‰ 540px) | 5 åˆ†é’Ÿ |
| æ–‡æœ¬åŒºåŸŸå®½åº¦æ”¹ä¸º 75% | ä¿®æ”¹ `render.ts:129` (å½“å‰ 68%) | 5 åˆ†é’Ÿ |
| Quote/Author é—´è·æ”¹ä¸º 1 è¡Œ | ä¿®æ”¹ `render.ts:160` çš„ `authorGap` | 10 åˆ†é’Ÿ |
| å¯¼å‡ºæ–‡ä»¶åè§„åˆ™ | ä¿®æ”¹ `onExport` å‡½æ•° | 10 åˆ†é’Ÿ |

### ğŸŸ¡ ä¸­ç­‰æ”¹åŠ¨

| æ”¹åŠ¨ | è¯„ä¼° | å·¥ä½œé‡ |
|------|------|--------|
| **å­—ä½“æ›¿æ¢** | éœ€ä¸‹è½½å­—ä½“æ–‡ä»¶åˆ° `/public/fonts/`ï¼Œä¿®æ”¹ `@font-face` å’Œ preset é…ç½® | 30 åˆ†é’Ÿ |
| **Author ç‹¬ç«‹å¯¹é½** | å¢åŠ  `authorAlign` çŠ¶æ€ï¼Œä¿®æ”¹æ¸²æŸ“é€»è¾‘ | 30 åˆ†é’Ÿ |
| **é£æ ¼é€‰æ‹©å™¨åŠ ç¼©ç•¥å›¾** | ä¸‹è½½é¢„è§ˆå›¾åˆ°æœ¬åœ°ï¼Œä¿®æ”¹ Pills ç»„ä»¶ä¸ºå¡ç‰‡å½¢å¼ | 45 åˆ†é’Ÿ |
| **æ’ç‰ˆå‚æ•°è°ƒæ•´** | æ›´æ–°å„ Preset çš„å­—å·/è¡Œé«˜/é¢œè‰² | 30 åˆ†é’Ÿ |

### ğŸ”´ é‡å¤§æ¶æ„æ”¹åŠ¨

| æ”¹åŠ¨ | è¯„ä¼° | æŠ€æœ¯æ–¹æ¡ˆ | å·¥ä½œé‡ |
|------|------|---------|--------|
| **æ»¤é•œä»ç®—æ³•æ”¹ä¸ºå›¾ç‰‡å åŠ ** | éœ€å®Œå…¨é‡æ„èƒŒæ™¯æ¸²æŸ“ç®¡é“ | è§ä¸‹æ–¹è¯¦ç»†æ–¹æ¡ˆ | 2-3 å°æ—¶ |

---

## ä¸‰ã€æ ¸å¿ƒæ¶æ„æ”¹åŠ¨è¯¦è§£

### å½“å‰å®ç° vs V5 è¦æ±‚

```
ã€å½“å‰ã€‘
Canvas
â”œâ”€ çº¯è‰²èƒŒæ™¯ (baseColor)
â”œâ”€ å™ªå£°çº¹ç† (ç®—æ³•ç”Ÿæˆ)
â”œâ”€ æš–è‰²å åŠ  (ç®—æ³•)
â”œâ”€ é¢—ç²’æ•ˆæœ (ç®—æ³•)
â”œâ”€ CSS Filter (contrast/saturate/brightness)
â””â”€ æ–‡æœ¬å±‚

ã€V5 è¦æ±‚ã€‘
Canvas
â”œâ”€ Background Image (é™æ€å›¾ç‰‡, cover å¡«å……)
â”œâ”€ Filter Image (Multiply å åŠ , opacity = é£æ ¼å¼ºåº¦)
â””â”€ Text Layer (Quote + Author, å‚ç›´å±…ä¸­)
```

### æŠ€æœ¯å¯è¡Œæ€§: âœ… å®Œå…¨å¯è¡Œ

Canvas 2D åŸç”Ÿæ”¯æŒæ‰€æœ‰éœ€æ±‚:
- `ctx.globalCompositeOperation = 'multiply'` - ç›´æ¥æ”¯æŒ
- `ctx.globalAlpha = strength / 100` - æ§åˆ¶å åŠ é€æ˜åº¦
- `drawImageCover()` - éœ€è¦å®ç°é€šç”¨å‡½æ•°

### å®æ–½æ–¹æ¡ˆ

#### 1. æ–°å»ºå›¾ç‰‡èµ„æºç›®å½•ç»“æ„

```
/public/
â”œâ”€â”€ fonts/
â”‚   â”œâ”€â”€ CrimsonText-SemiBold.ttf
â”‚   â”œâ”€â”€ CrimsonText-SemiBoldItalic.ttf
â”‚   â”œâ”€â”€ AveriaSerifLibre-Bold.ttf
â”‚   â”œâ”€â”€ AveriaSerifLibre-BoldItalic.ttf
â”‚   â””â”€â”€ athena-unicode.ttf
â””â”€â”€ presets/
    â”œâ”€â”€ editorial/
    â”‚   â”œâ”€â”€ bg.png
    â”‚   â””â”€â”€ filter.png
    â”œâ”€â”€ classic/
    â”‚   â”œâ”€â”€ bg.png
    â”‚   â””â”€â”€ filter.png
    â””â”€â”€ modern/
        â”œâ”€â”€ bg.png
        â””â”€â”€ filter.png
```

#### 2. é‡æ„ Preset ç±»å‹å®šä¹‰ (`types.ts`)

```typescript
type Preset = {
  id: PresetId
  label: string
  previewImage: string      // é€‰æ‹©å™¨ç¼©ç•¥å›¾
  backgroundImage: string   // èƒŒæ™¯å›¾è·¯å¾„
  filterImage: string       // æ»¤é•œå åŠ å›¾è·¯å¾„
  defaultStrength: number   // é»˜è®¤ 50
  typography: {
    quoteFontFamily: string
    quoteFontWeight: number
    quoteFontStyle: 'normal' | 'italic'
    quoteSize: number       // å›ºå®šå­—å·
    quoteLineHeight: number // å¦‚ 1.7
    quoteColor: string
    authorFontFamily: string
    authorFontWeight: number
    authorFontStyle: 'normal' | 'italic'
    authorSize: number
    authorLineHeight: number
    authorColor: string
  }
}
```

#### 3. æ–°æ¸²æŸ“ç®¡é“ (`render.ts`)

```typescript
// æ ¸å¿ƒæ¸²æŸ“å‡½æ•°
export async function renderToCanvas(canvas, input) {
  const { ctx } = setCanvasDPR(canvas, size.w, size.h)

  // 1. èƒŒæ™¯å›¾ (cover å¡«å……)
  await drawImageCover(ctx, bgImage, size.w, size.h)

  // 2. æ»¤é•œå åŠ å›¾ (Multiply + opacity)
  ctx.save()
  ctx.globalCompositeOperation = 'multiply'
  ctx.globalAlpha = input.styleStrength / 100
  await drawImageCover(ctx, filterImage, size.w, size.h)
  ctx.restore()

  // 3. æ–‡æœ¬å±‚
  drawTextBlock(ctx, input)
}

// é€šç”¨ cover å¡«å……å‡½æ•°
function drawImageCover(ctx, img, canvasW, canvasH) {
  const scale = Math.max(canvasW / img.width, canvasH / img.height)
  const w = img.width * scale
  const h = img.height * scale
  const x = (canvasW - w) / 2
  const y = (canvasH - h) / 2
  ctx.drawImage(img, x, y, w, h)
}
```

#### 4. å›¾ç‰‡é¢„åŠ è½½

```typescript
// åœ¨ App åˆå§‹åŒ–æ—¶é¢„åŠ è½½æ‰€æœ‰å›¾ç‰‡
const imageCache = new Map<string, HTMLImageElement>()

async function preloadPresetImages() {
  await document.fonts.ready
  for (const preset of PRESETS) {
    await loadImage(preset.backgroundImage)
    await loadImage(preset.filterImage)
  }
}
```

---

## å››ã€éœ€è¦ä¸‹è½½çš„å¤–éƒ¨èµ„æº

æ ¹æ® V5 æ–‡æ¡£æä¾›çš„ URLï¼Œéœ€è¦ä¸‹è½½ä»¥ä¸‹èµ„æºåˆ°æœ¬åœ°:

| èµ„æºç±»å‹ | URL | æœ¬åœ°è·¯å¾„ |
|---------|-----|---------|
| Editorial é¢„è§ˆå›¾ | https://i.postimg.cc/wxXHc1mY/Editorial_1350.png | `/public/presets/editorial/preview.png` |
| Editorial èƒŒæ™¯å›¾ | https://i.postimg.cc/L8cggqPm/Editorial_bg_1350.png | `/public/presets/editorial/bg.png` |
| Editorial æ»¤é•œå›¾ | https://i.postimg.cc/dtDhWRmY/Editorial_filter_Multiply_1350.png | `/public/presets/editorial/filter.png` |
| Classic é¢„è§ˆå›¾ | https://i.postimg.cc/h4LgbXdF/Classic_1350.png | `/public/presets/classic/preview.png` |
| Classic èƒŒæ™¯å›¾ | https://i.postimg.cc/T3z55yb3/Classic_bg_1350.png | `/public/presets/classic/bg.png` |
| Classic æ»¤é•œå›¾ | https://i.postimg.cc/qMgNmcXp/Classic_filter_Multiply_1350.png | `/public/presets/classic/filter.png` |
| Modern é¢„è§ˆå›¾ | https://i.postimg.cc/NG6Y7KHw/Modern_1350.png | `/public/presets/modern/preview.png` |
| Modern èƒŒæ™¯å›¾ | https://i.postimg.cc/mgv11c92/Modern_bg_1350.png | `/public/presets/modern/bg.png` |
| Modern æ»¤é•œå›¾ | https://i.postimg.cc/Z5Pth241/Modern_filter_Multiply_1350.png | `/public/presets/modern/filter.png` |

### å­—ä½“æ–‡ä»¶éœ€è¦å•ç‹¬è·å–

- Crimson Text (Google Fonts å¯ä¸‹è½½)
- Averia Serif Libre (Google Fonts å¯ä¸‹è½½)
- New Athena Unicode (éœ€ä»å®˜æ–¹æºè·å–)

---

## äº”ã€éœ€åˆ é™¤çš„ä»£ç 

| æ–‡ä»¶ | åˆ é™¤å†…å®¹ |
|------|---------|
| `paper.ts` | æ•´ä¸ªæ–‡ä»¶å¯åˆ é™¤ (ä¸å†éœ€è¦ç®—æ³•ç”ŸæˆèƒŒæ™¯) |
| `presets.ts` | åˆ é™¤ `newsprint` é…ç½®, åˆ é™¤ `tone` ç›¸å…³å­—æ®µ, åˆ é™¤ `noise/vignette` é…ç½® |
| `render.ts` | åˆ é™¤ `computeTone()`, åˆ é™¤ CSS Filter åº”ç”¨é€»è¾‘, åˆ é™¤èƒŒæ™¯ç¼“å­˜ (æ”¹ä¸ºå›¾ç‰‡ç¼“å­˜) |
| `types.ts` | åˆ é™¤ `tone` ç±»å‹å®šä¹‰, ç®€åŒ– `background` ç±»å‹ |

---

## å…­ã€é£é™©ä¸å»ºè®®

### âš ï¸ æ½œåœ¨é£é™©

1. **å›¾ç‰‡åŠ è½½å»¶è¿Ÿ** - é¦–æ¬¡æ¸²æŸ“éœ€ç­‰å¾…å›¾ç‰‡åŠ è½½
   - å»ºè®®: æ·»åŠ  loading çŠ¶æ€æç¤º

2. **è·¨åŸŸå›¾ç‰‡é—®é¢˜** - å¦‚ç›´æ¥ä½¿ç”¨å¤–éƒ¨ URL ä¼šå¯¼è‡´ canvas taint
   - å»ºè®®: å¿…é¡»ä¸‹è½½åˆ°æœ¬åœ°æ‰˜ç®¡

3. **å­—ä½“æ–‡ä»¶ä½“ç§¯** - æœ¬åœ°å­—ä½“å¯èƒ½å¢åŠ é¦–å±åŠ è½½æ—¶é—´
   - å»ºè®®: ä½¿ç”¨ `font-display: swap` æˆ–é¢„åŠ è½½å…³é”®å­—ä½“

4. **å›¾ç‰‡å°ºå¯¸ä¸è´¨é‡** - 1350px é«˜åº¦çš„æºå›¾éœ€è¦è¶³å¤Ÿå¤§
   - å»ºè®®: ç¡®è®¤èµ„æºå›¾ç‰‡åˆ†è¾¨ç‡ â‰¥ 1080Ã—1350

### ğŸ’¡ å»ºè®®

1. **åˆ†é˜¶æ®µå®æ–½**
   - Phase 1: å­—ä½“æ›¿æ¢ + æ’ç‰ˆè°ƒæ•´ + UI å¾®è°ƒ (ä½é£é™©)
   - Phase 2: æ ¸å¿ƒæ¸²æŸ“æ¶æ„é‡æ„ (é«˜å½±å“)

2. **ä¿ç•™å›æ»šèƒ½åŠ›** - å»ºè®®åœ¨ git ä¸Šåˆ›å»º feature åˆ†æ”¯å¼€å‘

---

## ä¸ƒã€å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„ä¼°æ—¶é—´ |
|------|------|---------|
| Phase 1 | å­—ä½“æ›¿æ¢ + UI è°ƒæ•´ | 1-2 å°æ—¶ |
| Phase 2 | æ¸²æŸ“æ¶æ„é‡æ„ | 2-3 å°æ—¶ |
| Phase 3 | æµ‹è¯• + ç»†èŠ‚è°ƒä¼˜ | 1 å°æ—¶ |
| **æ€»è®¡** | | **4-6 å°æ—¶** |

---

## å…«ã€æ€»ç»“

V5 æ–‡æ¡£çš„ä¿®æ”¹æ„è§**æŠ€æœ¯ä¸Šå®Œå…¨å¯è¡Œ**ã€‚æ ¸å¿ƒå˜æ›´æ˜¯å°†æ»¤é•œä»ã€Œç®—æ³•ç”Ÿæˆã€æ”¹ä¸ºã€Œå›¾ç‰‡å åŠ ã€ï¼Œè¿™å®é™…ä¸Šç®€åŒ–äº†ä»£ç å¤æ‚åº¦ï¼ŒCanvas 2D åŸç”Ÿ `globalCompositeOperation = 'multiply'` å®Œç¾æ”¯æŒã€‚

**ä¸»è¦å·¥ä½œé‡é›†ä¸­åœ¨:**
1. ä¸‹è½½å¹¶æœ¬åœ°åŒ– 9 å¼ å›¾ç‰‡èµ„æº + 5 ä¸ªå­—ä½“æ–‡ä»¶
2. é‡æ„æ¸²æŸ“ç®¡é“ (åˆ é™¤ `paper.ts` ç®—æ³•é€»è¾‘ï¼Œæ”¹ä¸ºå›¾ç‰‡åŠ è½½+å åŠ )
3. æ›´æ–° Preset æ•°æ®ç»“æ„å’Œ UI ç»„ä»¶
